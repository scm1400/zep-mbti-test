<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI 테스트 결과</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #7C4DFF;
            --primary-light: #B39DDB;
            --primary-dark: #4527A0;
            --secondary-color: #FF4081;
            --text-primary: #333333;
            --text-secondary: #666666;
            --bg-light: #FFFFFF;
            --bg-medium: #F5F5F5;
            --bg-dark: rgba(0, 0, 0, 0.7);
            --border-radius: 10px;
            --shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-strong: 0 8px 20px rgba(124, 77, 255, 0.15);
            --transition-normal: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-primary);
            padding: 10px;
            line-height: 1.5;
        }

        .result-container {
            background-color: var(--bg-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-strong);
            width: 80%;
            max-width: 480px;
            padding: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .result-header {
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        .result-header::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 3px;
            background-color: var(--primary-color);
            left: 50%;
            bottom: -6px;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .result-header h1 {
            color: var(--primary-color);
            font-size: 19px;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .result-header h2 {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 400;
            margin-top: 0;
        }

        .result-main {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }

        .result-type {
            font-size: 26px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0 15px;
            letter-spacing: 1px;
            text-shadow: 0 2px 6px rgba(124, 77, 255, 0.2);
        }

        .result-image {
            width: 85px;
            height: 85px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 55px;
            filter: drop-shadow(0 4px 10px rgba(124, 77, 255, 0.3));
            transition: var(--transition-normal);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.1) 100%);
            border-radius: 50%;
            box-shadow: var(--shadow-soft);
        }

        .dimension-bars {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 15px 0;
            background: var(--bg-medium);
            padding: 12px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-soft);
        }

        .dimension-title {
            font-weight: 500;
            color: var(--primary-dark);
            margin-bottom: 6px;
            font-size: 14px;
        }

        .dimension-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .dimension-label {
            aspect-ratio: 1/1;
            font-weight: 700;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            box-shadow: 0 2px 4px rgba(124, 77, 255, 0.3);
            font-size: 12px;
        }

        .bar-container {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 8px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-light), var(--primary-color));
            border-radius: 10px;
            transition: width 1s ease-in-out;
        }

        .percentage {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 100px;
            text-align: left;
            font-weight: 500;
        }

        .result-description {
            text-align: left;
            margin: 15px 0;
            padding: 12px;
            background-color: var(--bg-medium);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-soft);
            position: relative;
            overflow: hidden;
        }

        .result-description::before {
            content: '"';
            position: absolute;
            top: -20px;
            left: 5px;
            font-size: 70px;
            opacity: 0.1;
            color: var(--primary-color);
            font-family: Georgia, serif;
        }

        .result-description h3 {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 6px;
            font-size: 15px;
            position: relative;
            display: inline-block;
        }

        .result-description p {
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.4;
        }

        .share-area {
            margin-top: 15px;
            background: linear-gradient(to bottom right, #f7f9ff, #eef1f7);
            padding: 12px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-soft);
        }

        .share-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .share-area h3 {
            color: var(--primary-color);
            font-size: 15px;
            font-weight: 600;
            margin: 0;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .share-button-container {
            position: relative;
            display: inline-block;
        }

        .share-button {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition-normal);
            font-size: 15px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }

        .share-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .share-button-copy {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .share-button-zep {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tooltip {
            position: absolute;
            background-color: var(--primary-dark);
            color: white;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 11px;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            opacity: 0;
            transition: var(--transition-normal);
            pointer-events: none;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 3px;
            border-style: solid;
            border-color: transparent transparent var(--primary-dark) transparent;
        }

        .share-text-container {
            width: 100%;
            margin: 12px auto 5px auto;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .share-text-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: left;
            margin-bottom: 5px;
        }

        .share-text-area {
            width: 100%;
            height: 75px;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid var(--primary-light);
            background-color: white;
            font-size: 12px;
            resize: none;
            color: var(--text-primary);
            font-family: 'Noto Sans KR', sans-serif;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
            margin: 0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: var(--transition-normal);
        }

        .share-text-area:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(124, 77, 255, 0.2);
        }

        .copy-success {
            display: none;
            color: var(--primary-color);
            margin-top: 8px;
            font-size: 13px;
            font-weight: 500;
            animation: fadeIn 0.5s ease;
        }

        .result-footer {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .result-footer button {
            background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 7px 12px;
            font-size: 12px;
            border-radius: 16px;
            cursor: pointer;
            transition: var(--transition-normal);
            font-weight: 500;
            box-shadow: 0 3px 8px rgba(124, 77, 255, 0.3);
            min-width: 105px;
        }

        .result-footer button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(124, 77, 255, 0.4);
        }

        #retry-test {
            background: linear-gradient(to right, #FF4081, #F50057);
            box-shadow: 0 3px 8px rgba(255, 64, 129, 0.3);
        }

        #retry-test:hover {
            box-shadow: 0 5px 12px rgba(255, 64, 129, 0.4);
        }

        #go-to-lounge {
            background: linear-gradient(to right, #26C6DA, #00ACC1);
            box-shadow: 0 3px 8px rgba(38, 198, 218, 0.3);
        }

        #go-to-lounge:hover {
            box-shadow: 0 5px 12px rgba(38, 198, 218, 0.4);
        }

        @media (max-width: 768px) {
            .result-container {
                width: 90%;
                padding: 12px;
            }
            
            .result-main {
                flex-direction: column;
            }
            
            .result-type {
                margin: 5px 0;
            }
            
            .dimension-bar {
                flex-wrap: wrap;
            }
            
            .percentage {
                width: 100%;
                text-align: center;
                margin-top: 4px;
                min-width: auto;
                font-size: 11px;
            }
            
            .result-footer {
                flex-direction: column;
            }
            
            .result-footer button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="result-container">
        <div class="result-header">
            <h1>MBTI 테스트 결과</h1>
            <h2>당신의 성격 유형은...</h2>
        </div>
        
        <div class="result-main">
            <div class="result-image" id="mbti-image"></div>
            <div class="result-type" id="mbti-type">ENFP</div>
        </div>
        
        <div class="dimension-bars">
            <div class="dimension-title">나의 성향 분석</div>
            <div class="dimension-bar">
                <div class="dimension-label">E</div>
                <div class="bar-container">
                    <div class="bar-fill" id="e-bar" style="width: 70%;"></div>
                </div>
                <div class="dimension-label">I</div>
                <div class="percentage" id="ei-percentage">E 70% / I 30%</div>
            </div>
            
            <div class="dimension-bar">
                <div class="dimension-label">S</div>
                <div class="bar-container">
                    <div class="bar-fill" id="s-bar" style="width: 45%;"></div>
                </div>
                <div class="dimension-label">N</div>
                <div class="percentage" id="sn-percentage">S 45% / N 55%</div>
            </div>
            
            <div class="dimension-bar">
                <div class="dimension-label">T</div>
                <div class="bar-container">
                    <div class="bar-fill" id="t-bar" style="width: 35%;"></div>
                </div>
                <div class="dimension-label">F</div>
                <div class="percentage" id="tf-percentage">T 35% / F 65%</div>
            </div>
            
            <div class="dimension-bar">
                <div class="dimension-label">J</div>
                <div class="bar-container">
                    <div class="bar-fill" id="j-bar" style="width: 20%;"></div>
                </div>
                <div class="dimension-label">P</div>
                <div class="percentage" id="jp-percentage">J 20% / P 80%</div>
            </div>
        </div>
        
        <div class="result-description">
            <h3 id="mbti-nickname">열정적인 활동가 (ENFP)</h3>
            <p id="mbti-description">열정적이고 창의적인 성격으로, 항상 새로운 가능성을 찾고 다양한 아이디어를 시도하는 것을 좋아합니다. 사람들과의 관계를 중요시하며, 다른 사람의 감정을 잘 이해하고 공감하는 능력이 뛰어납니다.</p>
        </div>
        
        <div class="share-area">
            <div class="share-header">
                <h3>결과 공유하기</h3>
                <div class="share-buttons">
                    <div class="share-button-container">
                        <div class="share-button share-button-copy" id="copy-result">
                            <span>📋</span>
                        </div>
                        <div class="tooltip">결과 복사하기</div>
                    </div>
                    <div class="share-button-container">
                        <div class="share-button share-button-zep" id="share-with-zep">
                            <span>Z</span>
                        </div>
                        <div class="tooltip">Zep 대화창에 공유하기</div>
                    </div>
                </div>
            </div>
            <div id="copy-success" class="copy-success">✓ 클립보드에 복사되었습니다</div>
            <div class="share-text-container">
                <p class="share-text-label">아래 텍스트가 복사됩니다:</p>
                <textarea id="share-text-area" class="share-text-area" readonly></textarea>
            </div>
        </div>
        
        <div class="result-footer">
            <button id="retry-test">다시 테스트하기</button>
            <button id="go-to-lounge">MBTI 라운지</button>
            <button id="close-result">닫기</button>
        </div>
    </div>

    <script>
        let mbtiResult = null;
        let shareText = "";
        
        // MBTI 유형별 이모지 매핑
        const mbtiEmojis = {
            "ISTJ": "⚖️",
            "ISFJ": "🛡️",
            "INFJ": "🔮",
            "INTJ": "🧠",
            "ISTP": "🔧",
            "ISFP": "🎨",
            "INFP": "🦄",
            "INTP": "🔬",
            "ESTP": "🏄‍♂️",
            "ESFP": "🎭",
            "ENFP": "✨",
            "ENTP": "💡",
            "ESTJ": "📊",
            "ESFJ": "🤝",
            "ENFJ": "🌟",
            "ENTJ": "👑"
        };
        
        // 앱에서 위젯으로 메시지를 보내면 동작하는 함수
        window.addEventListener("message", function(e) {
            if (e.data && e.data.mbtiResult) {
                updateResult(e.data.mbtiResult);
            }
        });
        
        // 페이지 로드 시 결과 요청
        document.addEventListener('DOMContentLoaded', function() {
            // 앱에 결과 데이터 요청
            sendMessageToApp({
                type: "REQUEST_MBTI_RESULT"
            });
            
            // 공유 버튼에 툴팁 이벤트 추가
            document.querySelectorAll('.share-button-container').forEach(container => {
                const tooltip = container.querySelector('.tooltip');
                
                container.addEventListener('mouseenter', function() {
                    tooltip.style.opacity = '1';
                });
                
                container.addEventListener('mouseleave', function() {
                    tooltip.style.opacity = '0';
                });
            });
            
            // 결과 컨테이너에 나타나는 애니메이션 추가
            animateResultContainer();
            
            // 테스트용 더미 데이터 (실제로는 앱에서 데이터를 받아옴)
            /*
            updateResult({
                mbtiType: "ENFP",
                percentages: {
                    EI: "E 70% / I 30%",
                    SN: "S 45% / N 55%", 
                    TF: "T 35% / F 65%",
                    JP: "J 20% / P 80%"
                }
            });
            */
        });
        
        // 결과 컨테이너 애니메이션 함수
        function animateResultContainer() {
            const container = document.querySelector('.result-container');
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';
            container.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
            
            setTimeout(() => {
                container.style.opacity = '1';
                container.style.transform = 'translateY(0)';
            }, 100);
        }
        
        function updateResult(result) {
            mbtiResult = result;
            const mbtiType = result.mbtiType || "ENFP";
            document.getElementById('mbti-type').textContent = mbtiType;
            
            console.log("업데이트 함수에서 받은 결과:", JSON.stringify(result));
            
            // 이모지 업데이트
            const imageElement = document.getElementById('mbti-image');
            imageElement.innerHTML = mbtiEmojis[mbtiType] || "✨"; // 기본값은 ENFP의 이모지
            
            // 백분율 표시 및 바 업데이트
            if (result.percentages) {
                const percentages = result.percentages;
                console.log("받은 percentages 데이터:", JSON.stringify(percentages));
                
                // 모든 바 초기화
                document.querySelectorAll('.bar-fill').forEach(bar => {
                    bar.style.width = '0%';
                });
                
                // 지연 후 애니메이션으로 바 채우기
                setTimeout(() => {
                    // EI 업데이트
                    if (percentages.EI) {
                        document.getElementById('ei-percentage').textContent = percentages.EI;
                        
                        // E/I 값 추출
                        let eValue = 50;
                        if (percentages.EI.startsWith('E')) {
                            const match = percentages.EI.match(/E\s*(\d+)%/);
                            if (match && match[1]) {
                                eValue = parseInt(match[1]);
                            }
                        } else if (percentages.EI.startsWith('I')) {
                            const match = percentages.EI.match(/I\s*(\d+)%/);
                            if (match && match[1]) {
                                eValue = 100 - parseInt(match[1]);
                            }
                        }
                        
                        document.getElementById('e-bar').style.width = `${eValue}%`;
                        console.log("E/I 바 설정:", eValue);
                    }
                    
                    setTimeout(() => {
                        // SN 업데이트
                        if (percentages.SN) {
                            document.getElementById('sn-percentage').textContent = percentages.SN;
                            
                            // S/N 값 추출
                            let sValue = 50;
                            if (percentages.SN.startsWith('S')) {
                                const match = percentages.SN.match(/S\s*(\d+)%/);
                                if (match && match[1]) {
                                    sValue = parseInt(match[1]);
                                }
                            } else if (percentages.SN.startsWith('N')) {
                                const match = percentages.SN.match(/N\s*(\d+)%/);
                                if (match && match[1]) {
                                    sValue = 100 - parseInt(match[1]);
                                }
                            }
                            
                            document.getElementById('s-bar').style.width = `${sValue}%`;
                            console.log("S/N 바 설정:", sValue);
                        }
                        
                        setTimeout(() => {
                            // TF 업데이트
                            if (percentages.TF) {
                                document.getElementById('tf-percentage').textContent = percentages.TF;
                                
                                // T/F 값 추출
                                let tValue = 50;
                                if (percentages.TF.startsWith('T')) {
                                    const match = percentages.TF.match(/T\s*(\d+)%/);
                                    if (match && match[1]) {
                                        tValue = parseInt(match[1]);
                                    }
                                } else if (percentages.TF.startsWith('F')) {
                                    const match = percentages.TF.match(/F\s*(\d+)%/);
                                    if (match && match[1]) {
                                        tValue = 100 - parseInt(match[1]);
                                    }
                                }
                                
                                document.getElementById('t-bar').style.width = `${tValue}%`;
                                console.log("T/F 바 설정:", tValue);
                            }
                            
                            setTimeout(() => {
                                // JP 업데이트
                                if (percentages.JP) {
                                    document.getElementById('jp-percentage').textContent = percentages.JP;
                                    
                                    // J/P 값 추출
                                    let jValue = 50;
                                    if (percentages.JP.startsWith('J')) {
                                        const match = percentages.JP.match(/J\s*(\d+)%/);
                                        if (match && match[1]) {
                                            jValue = parseInt(match[1]);
                                        }
                                    } else if (percentages.JP.startsWith('P')) {
                                        const match = percentages.JP.match(/P\s*(\d+)%/);
                                        if (match && match[1]) {
                                            jValue = 100 - parseInt(match[1]);
                                        }
                                    }
                                    
                                    document.getElementById('j-bar').style.width = `${jValue}%`;
                                    console.log("J/P 바 설정:", jValue);
                                }
                            }, 200);
                        }, 200);
                    }, 200);
                }, 400);
            }
            
            // MBTI 유형별 설명 및 별명 업데이트
            const mbtiDescriptions = {
                "ISTJ": {
                    nickname: "청렴결백한 논리주의자 (ISTJ)",
                    description: "체계적이고 사실적인 성격으로, 책임감이 강하고 신뢰할 수 있는 사람입니다. 논리적이고 체계적으로 일을 처리하며, 세부 사항에 주의를 기울이는 능력이 뛰어납니다. 전통적인 가치를 중요시하며 약속을 지키는 것을 중요하게 생각합니다."
                },
                "ISFJ": {
                    nickname: "용감한 수호자 (ISFJ)",
                    description: "다정하고 책임감 있는 성격으로, 다른 사람의 필요에 민감하게 반응합니다. 세부 사항에 주의를 기울이고 다른 사람을 배려하며 도움을 주는 것을 좋아합니다. 전통과 안정성을 중요시하며, 조용하고 진실된 관계를 선호합니다."
                },
                "INFJ": {
                    nickname: "선의의 옹호자 (INFJ)",
                    description: "이상주의적이고 원칙적인 성격으로, 다른 사람과 세상을 더 나은 곳으로 만들고자 하는 강한 열망을 가지고 있습니다. 통찰력이 뛰어나며 다른 사람의 감정과 동기를 잘 이해합니다. 진실된 관계와 의미 있는 일을 추구합니다."
                },
                "INTJ": {
                    nickname: "용의주도한 전략가 (INTJ)",
                    description: "독립적이고 분석적인 성격으로, 복잡한 문제를 해결하는 것을 좋아합니다. 지적 호기심이 많으며 새로운 아이디어와 개념을 탐구하는 것을 즐깁니다. 목표 지향적이고 비판적인 사고를 통해 효율적인 해결책을 찾아냅니다."
                },
                "ISTP": {
                    nickname: "만능 재주꾼 (ISTP)",
                    description: "논리적이고 실용적인 성격으로, 문제 해결에 뛰어난 능력을 가지고 있습니다. 기계적인 작업이나 손으로 하는 작업을 즐기며, 현재의 상황에 집중하는 경향이 있습니다. 독립적이고 자유를 추구하며, 자신만의 방식으로 일하는 것을 선호합니다."
                },
                "ISFP": {
                    nickname: "호기심 많은 예술가 (ISFP)",
                    description: "감성적이고 예술적인 성격으로, 아름다움과 감각적인 경험을 중요시합니다. 자신만의 가치관을 가지고 있으며, 조용하고 겸손한 태도를 유지합니다. 현재에 집중하며 자연스럽고 자유로운 삶을 추구합니다."
                },
                "INFP": {
                    nickname: "열정적인 중재자 (INFP)",
                    description: "이상주의적이고 창의적인 성격으로, 자신의 가치관에 따라 살아갑니다. 다른 사람의 감정에 민감하게 반응하며, 조화와 이해를 추구합니다. 내면의 세계가 풍부하고 상상력이 풍부하며, 자신의 독특한 방식으로 세상에 기여하고자 합니다."
                },
                "INTP": {
                    nickname: "논리적인 사색가 (INTP)",
                    description: "지적 호기심이 많고 분석적인 성격으로, 복잡한 이론과 아이디어를 탐구하는 것을 좋아합니다. 논리적으로 사고하며 문제의 근본적인 원리를 이해하고자 합니다. 독립적이고 창의적인 사고를 통해 새로운 지식을 추구합니다."
                },
                "ESTP": {
                    nickname: "모험을 즐기는 사업가 (ESTP)",
                    description: "활동적이고 실용적인 성격으로, 현재의 상황에 집중하고 즉각적인 결과를 추구합니다. 위험을 감수하는 것을 두려워하지 않으며, 문제 해결 능력이 뛰어납니다. 사교적이고 적응력이 강하며, 새로운 경험을 즐깁니다."
                },
                "ESFP": {
                    nickname: "자유로운 영혼의 연예인 (ESFP)",
                    description: "열정적이고 즐거움을 추구하는 성격으로, 사람들과 함께하는 것을 좋아합니다. 현재에 집중하며 감각적인 경험을 중요시합니다. 사교적이고 매력적인 성격으로, 다른 사람에게 기쁨과 흥미를 불러일으킵니다."
                },
                "ENFP": {
                    nickname: "열정적인 활동가 (ENFP)",
                    description: "열정적이고 창의적인 성격으로, 항상 새로운 가능성을 찾고 다양한 아이디어를 시도하는 것을 좋아합니다. 사람들과의 관계를 중요시하며, 다른 사람의 감정을 잘 이해하고 공감하는 능력이 뛰어납니다. 자유로운 분위기에서 일하는 것을 선호하며, 규칙이나 틀에 얽매이는 것을 좋아하지 않습니다."
                },
                "ENTP": {
                    nickname: "논쟁을 즐기는 변론가 (ENTP)",
                    description: "지적 호기심이 많고 창의적인 성격으로, 새로운 아이디어와 가능성을 탐구하는 것을 좋아합니다. 논리적으로 사고하며 다양한 관점에서 문제를 바라보는 능력이 뛰어납니다. 도전적인 토론을 즐기며, 규칙이나 관습에 얽매이지 않고 자유롭게 생각합니다."
                },
                "ESTJ": {
                    nickname: "엄격한 관리자 (ESTJ)",
                    description: "체계적이고 실용적인 성격으로, 책임감이 강하고 결과 지향적입니다. 논리적으로 사고하며 효율적인 방식으로 목표를 달성하고자 합니다. 전통과 질서를 중요시하며, 리더십을 발휘하여 조직을 이끄는 능력이 뛰어납니다."
                },
                "ESFJ": {
                    nickname: "사교적인 외교관 (ESFJ)",
                    description: "다정하고 배려심이 많은 성격으로, 다른 사람의 필요에 민감하게 반응합니다. 사람들과의 관계를 중요시하며, 조화로운 환경을 만들고자 합니다. 책임감이 강하고 협력적이며, 다른 사람을 도우며 기쁨을 느낍니다."
                },
                "ENFJ": {
                    nickname: "정의로운 사회운동가 (ENFJ)",
                    description: "따뜻하고 이타적인 성격으로, 다른 사람의 잠재력을 끌어내고 성장을 돕는 것을 좋아합니다. 감정적으로 공감하는 능력이 뛰어나며, 조화와 협력을 중요시합니다. 카리스마 있는 리더십을 발휘하여 긍정적인 변화를 이끌어내고자 합니다."
                },
                "ENTJ": {
                    nickname: "대담한 통솔자 (ENTJ)",
                    description: "자신감 있고 결단력 있는 성격으로, 장기적인 비전과 목표를 가지고 있습니다. 논리적으로 사고하며 효율적인 전략을 세우는 능력이 뛰어납니다. 리더십을 발휘하여 조직을 이끌고, 도전적인 목표를 달성하기 위해 노력합니다."
                }
            };
            
            const mbtiInfo = mbtiDescriptions[mbtiType] || mbtiDescriptions["ENFP"];
            
            // 애니메이션을 위한 지연
            setTimeout(() => {
                document.getElementById('mbti-nickname').textContent = mbtiInfo.nickname;
                document.getElementById('mbti-description').textContent = mbtiInfo.description;
                
                // 결과 설명에 페이드인 효과 추가
                const descriptionElement = document.querySelector('.result-description');
                descriptionElement.style.opacity = '0';
                descriptionElement.style.transform = 'translateY(10px)';
                descriptionElement.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                
                setTimeout(() => {
                    descriptionElement.style.opacity = '1';
                    descriptionElement.style.transform = 'translateY(0)';
                }, 100);
                
                // 공유 텍스트 생성
                createShareText(mbtiType, mbtiInfo, result.percentages);
            }, 1200);
        }
        
        // 공유용 텍스트 생성 함수
        function createShareText(mbtiType, mbtiInfo, percentages) {
            shareText = `[MBTI 테스트 결과]\n\n`;
            shareText += `🏆 나의 MBTI: ${mbtiType}\n`;
            shareText += `✨ ${mbtiInfo.nickname}\n\n`;
            
            if (percentages) {
                shareText += `🔍 성향 분석:\n`;
                shareText += `${percentages.EI}\n`;
                shareText += `${percentages.SN}\n`;
                shareText += `${percentages.TF}\n`;
                shareText += `${percentages.JP}\n\n`;
            }
            
            shareText += `💬 ${mbtiInfo.description.substring(0, 100)}...\n\n`;
            shareText += `✅ Zep MBTI 테스트에서 확인하세요!`;
            shareText += `✅ https://zep.us/play/5rXrlv!`;
            
            // 공유 텍스트를 텍스트 영역에 설정
            document.getElementById('share-text-area').value = shareText;
        }
        
        // 버튼 클릭 이벤트 처리
        document.getElementById('close-result').addEventListener('click', function() {
            // 닫기 애니메이션
            const container = document.querySelector('.result-container');
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';
            
            // 애니메이션이 끝난 후 앱에 메시지 전송
            setTimeout(() => {
                sendMessageToApp({
                    type: "CLOSE_RESULT"
                });
            }, 300);
        });
        
        document.getElementById('retry-test').addEventListener('click', function() {
            // 닫기 애니메이션
            const container = document.querySelector('.result-container');
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';
            
            // 애니메이션이 끝난 후 앱에 메시지 전송
            setTimeout(() => {
                sendMessageToApp({
                    type: "RETRY_MBTI_TEST"
                });
            }, 300);
        });
        
        // MBTI 라운지로 이동 버튼
        document.getElementById('go-to-lounge').addEventListener('click', function() {
            // 닫기 애니메이션
            const container = document.querySelector('.result-container');
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';
            
            // 애니메이션이 끝난 후 앱에 메시지 전송
            setTimeout(() => {
                sendMessageToApp({
                    type: "GO_TO_MBTI_LOUNGE"
                });
            }, 300);
        });
        
        // 결과 복사 버튼
        document.getElementById('copy-result').addEventListener('click', function() {
            // TextArea 표시 및 내용 설정 (모든 경우에)
            const textContainer = document.querySelector('.share-text-container');
            const textArea = document.getElementById('share-text-area');
            textContainer.style.display = 'block';
            textArea.value = shareText;
            
            try {
                // 클립보드에 직접 복사 (현대적인 방식)
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(shareText)
                        .then(() => {
                            const copySuccess = document.getElementById('copy-success');
                            copySuccess.style.display = 'block';
                            
                            // 성공 메시지는 2초 후 숨김
                            setTimeout(() => {
                                copySuccess.style.display = 'none';
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('클립보드 API 사용 실패:', err);
                            fallbackCopy();
                        });
                } else {
                    fallbackCopy();
                }
            } catch (err) {
                console.error('복사 실패:', err);
                alert('클립보드 복사를 지원하지 않는 브라우저입니다. 텍스트를 직접 선택하여 복사해주세요.');
            }
        });
        
        // 대체 복사 방법 (이전 방식)
        function fallbackCopy() {
            const textArea = document.getElementById('share-text-area');
            
            try {
                textArea.focus();
                textArea.select();
                const successful = document.execCommand('copy');
                
                if (successful) {
                    const copySuccess = document.getElementById('copy-success');
                    copySuccess.style.display = 'block';
                    
                    setTimeout(() => {
                        copySuccess.style.display = 'none';
                    }, 2000);
                } else {
                    throw new Error('복사 실패');
                }
            } catch (err) {
                console.error('복사 실패:', err);
                alert('클립보드 복사를 지원하지 않는 브라우저입니다. 텍스트를 직접 선택하여 복사해주세요.');
            }
        }
        
        // Zep 대화창에 공유하기 버튼
        document.getElementById('share-with-zep').addEventListener('click', function() {
            // 텍스트 컨테이너 표시
            const textContainer = document.querySelector('.share-text-container');
            const textArea = document.getElementById('share-text-area');
            textContainer.style.display = 'block';
            textArea.value = shareText;
            
            // 앱으로 공유 메시지 전송
            sendMessageToApp({
                type: "SHARE_TO_ZEP_CHAT",
                content: shareText
            });
            
            const copySuccess = document.getElementById('copy-success');
            copySuccess.textContent = "✓ Zep 채팅에 공유되었습니다";
            copySuccess.style.display = 'block';
            
            setTimeout(() => {
                copySuccess.style.display = 'none';
                copySuccess.textContent = "✓ 클립보드에 복사되었습니다";
            }, 2000);
        });
        
        // 앱으로 메시지를 보내는 함수
        function sendMessageToApp(data) {
            window.parent.postMessage(data, "*");
        }
    </script>
</body>
</html> 