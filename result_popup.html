<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI 테스트 결과</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #333;
        }
        .result-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 700px;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        .result-header {
            margin-bottom: 20px;
        }
        .result-header h1 {
            color: #5D4FFF;
            font-size: 28px;
            margin-bottom: 10px;
        }
        .result-header h2 {
            color: #5D4FFF;
            font-size: 20px;
            font-weight: normal;
            margin-top: 0;
        }
        .result-content {
            margin-bottom: 25px;
            line-height: 1.6;
            text-align: left;
        }
        .result-type {
            font-size: 36px;
            font-weight: bold;
            color: #5D4FFF;
            margin: 10px 0;
        }
        .result-image {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        .dimension-bars {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }
        .dimension-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .dimension-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 5px;
        }
        .dimension-label {
            font-weight: bold;
            width: 30px;
        }
        .bar-container {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 10px;
        }
        .bar-fill {
            height: 100%;
            background-color: #5D4FFF;
            border-radius: 10px;
        }
        .percentage {
            font-size: 14px;
            color: #666;
        }
        .result-description {
            text-align: left;
            margin: 20px 0;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 10px;
        }
        .result-description h3 {
            color: #5D4FFF;
            margin-top: 0;
        }
        .result-footer {
            margin-top: 30px;
        }
        .result-footer button {
            background-color: #5D4FFF;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 0 10px;
        }
        .result-footer button:hover {
            background-color: #4A3FD1;
        }
        .share-buttons {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 15px;
        }
        .share-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 20px;
        }
        .share-button:hover {
            background-color: #e0e0e0;
        }
        .share-button-copy {
            background-color: #f0f0f0;
        }
        .share-button-zep {
            background-color: #5D4FFF;
            color: white;
        }
        .tooltip {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        .share-button-container {
            position: relative;
            display: inline-block;
        }
        .share-area {
            margin-top: 15px;
        }
        .share-text-container {
            width: 90%;
            max-width: 500px;
            margin: 15px auto 5px auto;
            display: none;
        }
        .share-text-label {
            font-size: 14px;
            color: #555;
            text-align: left;
            margin-bottom: 5px;
        }
        .share-text-area {
            width: 100%;
            height: 120px;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #5D4FFF;
            background-color: #f9f9f9;
            font-size: 14px;
            resize: none;
            color: #333;
            font-family: 'Noto Sans KR', sans-serif;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
            margin: 0;
        }
        .copy-success {
            display: none;
            color: #5D4FFF;
            margin-top: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="result-container">
        <div class="result-header">
            <h1>MBTI 테스트 결과</h1>
            <h2>당신의 성격 유형은...</h2>
        </div>
        
        <div class="result-type" id="mbti-type">ENFP</div>
        <div class="result-image" id="mbti-image"></div>
        
        <div class="dimension-bars">
            <div class="dimension-bar">
                <div class="dimension-label">E</div>
                <div class="bar-container">
                    <div class="bar-fill" id="e-bar" style="width: 70%;"></div>
                </div>
                <div class="dimension-label">I</div>
                <div class="percentage" id="ei-percentage">E 70% / I 30%</div>
            </div>
            
            <div class="dimension-bar">
                <div class="dimension-label">S</div>
                <div class="bar-container">
                    <div class="bar-fill" id="s-bar" style="width: 45%;"></div>
                </div>
                <div class="dimension-label">N</div>
                <div class="percentage" id="sn-percentage">S 45% / N 55%</div>
            </div>
            
            <div class="dimension-bar">
                <div class="dimension-label">T</div>
                <div class="bar-container">
                    <div class="bar-fill" id="t-bar" style="width: 35%;"></div>
                </div>
                <div class="dimension-label">F</div>
                <div class="percentage" id="tf-percentage">T 35% / F 65%</div>
            </div>
            
            <div class="dimension-bar">
                <div class="dimension-label">J</div>
                <div class="bar-container">
                    <div class="bar-fill" id="j-bar" style="width: 20%;"></div>
                </div>
                <div class="dimension-label">P</div>
                <div class="percentage" id="jp-percentage">J 20% / P 80%</div>
            </div>
        </div>
        
        <div class="result-description">
            <h3 id="mbti-nickname">열정적인 활동가 (ENFP)</h3>
            <p id="mbti-description">열정적이고 창의적인 성격으로, 항상 새로운 가능성을 찾고 다양한 아이디어를 시도하는 것을 좋아합니다. 사람들과의 관계를 중요시하며, 다른 사람의 감정을 잘 이해하고 공감하는 능력이 뛰어납니다. 자유로운 분위기에서 일하는 것을 선호하며, 규칙이나 틀에 얽매이는 것을 좋아하지 않습니다.</p>
        </div>
        
        <div class="share-area">
            <h3>결과 공유하기</h3>
            <div class="share-buttons">
                <div class="share-button-container">
                    <div class="share-button share-button-copy" id="copy-result">
                        <span>📋</span>
                    </div>
                    <div class="tooltip">결과 복사하기</div>
                </div>
                <div class="share-button-container">
                    <div class="share-button share-button-zep" id="share-with-zep">
                        <span>Z</span>
                    </div>
                    <div class="tooltip">Zep 대화창에 공유하기</div>
                </div>
            </div>
            <div id="copy-success" class="copy-success">✓ 클립보드에 복사되었습니다</div>
            <div class="share-text-container">
                <p class="share-text-label">아래 텍스트가 복사됩니다:</p>
                <textarea id="share-text-area" class="share-text-area" readonly></textarea>
            </div>
        </div>
        
        <div class="result-footer">
            <button id="close-result">닫기</button>
            <button id="retry-test">다시 테스트하기</button>
        </div>
    </div>

    <script>
        let mbtiResult = null;
        let shareText = "";
        
        // 앱에서 위젯으로 메시지를 보내면 동작하는 함수
        window.addEventListener("message", function(e) {
            if (e.data && e.data.mbtiResult) {
                updateResult(e.data.mbtiResult);
            }
        });
        
        // 페이지 로드 시 결과 요청
        document.addEventListener('DOMContentLoaded', function() {
            // 앱에 결과 데이터 요청
            sendMessageToApp({
                type: "REQUEST_MBTI_RESULT"
            });
            
            // 공유 버튼에 툴팁 이벤트 추가
            document.querySelectorAll('.share-button-container').forEach(container => {
                const tooltip = container.querySelector('.tooltip');
                
                container.addEventListener('mouseenter', function() {
                    tooltip.style.opacity = '1';
                });
                
                container.addEventListener('mouseleave', function() {
                    tooltip.style.opacity = '0';
                });
            });
            
            // 테스트용 더미 데이터 (실제로는 앱에서 데이터를 받아옴)
            /*
            updateResult({
                mbtiType: "ENFP",
                percentages: {
                    EI: "E 70% / I 30%",
                    SN: "S 45% / N 55%", 
                    TF: "T 35% / F 65%",
                    JP: "J 20% / P 80%"
                }
            });
            */
        });
        
        function updateResult(result) {
            mbtiResult = result;
            const mbtiType = result.mbtiType || "ENFP";
            document.getElementById('mbti-type').textContent = mbtiType;
            
            // 이미지 업데이트
            const imageElement = document.getElementById('mbti-image');
            imageElement.style.backgroundImage = `url('mbti/${mbtiType}.png')`;
            
            // 백분율 표시 및 바 업데이트
            if (result.percentages) {
                const percentages = result.percentages;
                
                if (percentages.EI) {
                    document.getElementById('ei-percentage').textContent = percentages.EI;
                    const eiMatch = percentages.EI.match(/E\s*(\d+)%/);
                    if (eiMatch && eiMatch[1]) {
                        document.getElementById('e-bar').style.width = `${eiMatch[1]}%`;
                    }
                }
                
                if (percentages.SN) {
                    document.getElementById('sn-percentage').textContent = percentages.SN;
                    const snMatch = percentages.SN.match(/S\s*(\d+)%/);
                    if (snMatch && snMatch[1]) {
                        document.getElementById('s-bar').style.width = `${snMatch[1]}%`;
                    }
                }
                
                if (percentages.TF) {
                    document.getElementById('tf-percentage').textContent = percentages.TF;
                    const tfMatch = percentages.TF.match(/T\s*(\d+)%/);
                    if (tfMatch && tfMatch[1]) {
                        document.getElementById('t-bar').style.width = `${tfMatch[1]}%`;
                    }
                }
                
                if (percentages.JP) {
                    document.getElementById('jp-percentage').textContent = percentages.JP;
                    const jpMatch = percentages.JP.match(/J\s*(\d+)%/);
                    if (jpMatch && jpMatch[1]) {
                        document.getElementById('j-bar').style.width = `${jpMatch[1]}%`;
                    }
                }
            }
            
            // MBTI 유형별 설명 및 별명 업데이트
            const mbtiDescriptions = {
                "ISTJ": {
                    nickname: "청렴결백한 논리주의자 (ISTJ)",
                    description: "체계적이고 사실적인 성격으로, 책임감이 강하고 신뢰할 수 있는 사람입니다. 논리적이고 체계적으로 일을 처리하며, 세부 사항에 주의를 기울이는 능력이 뛰어납니다. 전통적인 가치를 중요시하며 약속을 지키는 것을 중요하게 생각합니다."
                },
                "ISFJ": {
                    nickname: "용감한 수호자 (ISFJ)",
                    description: "다정하고 책임감 있는 성격으로, 다른 사람의 필요에 민감하게 반응합니다. 세부 사항에 주의를 기울이고 다른 사람을 배려하며 도움을 주는 것을 좋아합니다. 전통과 안정성을 중요시하며, 조용하고 진실된 관계를 선호합니다."
                },
                "INFJ": {
                    nickname: "선의의 옹호자 (INFJ)",
                    description: "이상주의적이고 원칙적인 성격으로, 다른 사람과 세상을 더 나은 곳으로 만들고자 하는 강한 열망을 가지고 있습니다. 통찰력이 뛰어나며 다른 사람의 감정과 동기를 잘 이해합니다. 진실된 관계와 의미 있는 일을 추구합니다."
                },
                "INTJ": {
                    nickname: "용의주도한 전략가 (INTJ)",
                    description: "독립적이고 분석적인 성격으로, 복잡한 문제를 해결하는 것을 좋아합니다. 지적 호기심이 많으며 새로운 아이디어와 개념을 탐구하는 것을 즐깁니다. 목표 지향적이고 비판적인 사고를 통해 효율적인 해결책을 찾아냅니다."
                },
                "ISTP": {
                    nickname: "만능 재주꾼 (ISTP)",
                    description: "논리적이고 실용적인 성격으로, 문제 해결에 뛰어난 능력을 가지고 있습니다. 기계적인 작업이나 손으로 하는 작업을 즐기며, 현재의 상황에 집중하는 경향이 있습니다. 독립적이고 자유를 추구하며, 자신만의 방식으로 일하는 것을 선호합니다."
                },
                "ISFP": {
                    nickname: "호기심 많은 예술가 (ISFP)",
                    description: "감성적이고 예술적인 성격으로, 아름다움과 감각적인 경험을 중요시합니다. 자신만의 가치관을 가지고 있으며, 조용하고 겸손한 태도를 유지합니다. 현재에 집중하며 자연스럽고 자유로운 삶을 추구합니다."
                },
                "INFP": {
                    nickname: "열정적인 중재자 (INFP)",
                    description: "이상주의적이고 창의적인 성격으로, 자신의 가치관에 따라 살아갑니다. 다른 사람의 감정에 민감하게 반응하며, 조화와 이해를 추구합니다. 내면의 세계가 풍부하고 상상력이 풍부하며, 자신의 독특한 방식으로 세상에 기여하고자 합니다."
                },
                "INTP": {
                    nickname: "논리적인 사색가 (INTP)",
                    description: "지적 호기심이 많고 분석적인 성격으로, 복잡한 이론과 아이디어를 탐구하는 것을 좋아합니다. 논리적으로 사고하며 문제의 근본적인 원리를 이해하고자 합니다. 독립적이고 창의적인 사고를 통해 새로운 지식을 추구합니다."
                },
                "ESTP": {
                    nickname: "모험을 즐기는 사업가 (ESTP)",
                    description: "활동적이고 실용적인 성격으로, 현재의 상황에 집중하고 즉각적인 결과를 추구합니다. 위험을 감수하는 것을 두려워하지 않으며, 문제 해결 능력이 뛰어납니다. 사교적이고 적응력이 강하며, 새로운 경험을 즐깁니다."
                },
                "ESFP": {
                    nickname: "자유로운 영혼의 연예인 (ESFP)",
                    description: "열정적이고 즐거움을 추구하는 성격으로, 사람들과 함께하는 것을 좋아합니다. 현재에 집중하며 감각적인 경험을 중요시합니다. 사교적이고 매력적인 성격으로, 다른 사람에게 기쁨과 흥미를 불러일으킵니다."
                },
                "ENFP": {
                    nickname: "열정적인 활동가 (ENFP)",
                    description: "열정적이고 창의적인 성격으로, 항상 새로운 가능성을 찾고 다양한 아이디어를 시도하는 것을 좋아합니다. 사람들과의 관계를 중요시하며, 다른 사람의 감정을 잘 이해하고 공감하는 능력이 뛰어납니다. 자유로운 분위기에서 일하는 것을 선호하며, 규칙이나 틀에 얽매이는 것을 좋아하지 않습니다."
                },
                "ENTP": {
                    nickname: "논쟁을 즐기는 변론가 (ENTP)",
                    description: "지적 호기심이 많고 창의적인 성격으로, 새로운 아이디어와 가능성을 탐구하는 것을 좋아합니다. 논리적으로 사고하며 다양한 관점에서 문제를 바라보는 능력이 뛰어납니다. 도전적인 토론을 즐기며, 규칙이나 관습에 얽매이지 않고 자유롭게 생각합니다."
                },
                "ESTJ": {
                    nickname: "엄격한 관리자 (ESTJ)",
                    description: "체계적이고 실용적인 성격으로, 책임감이 강하고 결과 지향적입니다. 논리적으로 사고하며 효율적인 방식으로 목표를 달성하고자 합니다. 전통과 질서를 중요시하며, 리더십을 발휘하여 조직을 이끄는 능력이 뛰어납니다."
                },
                "ESFJ": {
                    nickname: "사교적인 외교관 (ESFJ)",
                    description: "다정하고 배려심이 많은 성격으로, 다른 사람의 필요에 민감하게 반응합니다. 사람들과의 관계를 중요시하며, 조화로운 환경을 만들고자 합니다. 책임감이 강하고 협력적이며, 다른 사람을 도우며 기쁨을 느낍니다."
                },
                "ENFJ": {
                    nickname: "정의로운 사회운동가 (ENFJ)",
                    description: "따뜻하고 이타적인 성격으로, 다른 사람의 잠재력을 끌어내고 성장을 돕는 것을 좋아합니다. 감정적으로 공감하는 능력이 뛰어나며, 조화와 협력을 중요시합니다. 카리스마 있는 리더십을 발휘하여 긍정적인 변화를 이끌어내고자 합니다."
                },
                "ENTJ": {
                    nickname: "대담한 통솔자 (ENTJ)",
                    description: "자신감 있고 결단력 있는 성격으로, 장기적인 비전과 목표를 가지고 있습니다. 논리적으로 사고하며 효율적인 전략을 세우는 능력이 뛰어납니다. 리더십을 발휘하여 조직을 이끌고, 도전적인 목표를 달성하기 위해 노력합니다."
                }
            };
            
            const mbtiInfo = mbtiDescriptions[mbtiType] || mbtiDescriptions["ENFP"];
            document.getElementById('mbti-nickname').textContent = mbtiInfo.nickname;
            document.getElementById('mbti-description').textContent = mbtiInfo.description;
            
            // 공유 텍스트 생성
            createShareText(mbtiType, mbtiInfo, result.percentages);
        }
        
        // 공유용 텍스트 생성 함수
        function createShareText(mbtiType, mbtiInfo, percentages) {
            shareText = `[MBTI 테스트 결과]\n\n`;
            shareText += `🏆 나의 MBTI: ${mbtiType}\n`;
            shareText += `✨ ${mbtiInfo.nickname}\n\n`;
            
            if (percentages) {
                shareText += `🔍 성향 분석:\n`;
                shareText += `${percentages.EI}\n`;
                shareText += `${percentages.SN}\n`;
                shareText += `${percentages.TF}\n`;
                shareText += `${percentages.JP}\n\n`;
            }
            
            shareText += `💬 ${mbtiInfo.description.substring(0, 100)}...\n\n`;
            shareText += `✅ Zep MBTI 테스트에서 확인하세요!`;
            
            // 공유 텍스트를 텍스트 영역에 설정
            document.getElementById('share-text-area').value = shareText;
        }
        
        // 버튼 클릭 이벤트 처리
        document.getElementById('close-result').addEventListener('click', function() {
            sendMessageToApp({
                type: "CLOSE_RESULT"
            });
        });
        
        document.getElementById('retry-test').addEventListener('click', function() {
            sendMessageToApp({
                type: "RETRY_MBTI_TEST"
            });
        });
        
        // 결과 복사 버튼
        document.getElementById('copy-result').addEventListener('click', function() {
            // TextArea 표시 및 내용 설정 (모든 경우에)
            const textContainer = document.querySelector('.share-text-container');
            const textArea = document.getElementById('share-text-area');
            textContainer.style.display = 'block';
            textArea.value = shareText;
            
            try {
                // 클립보드에 직접 복사 (현대적인 방식)
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(shareText)
                        .then(() => {
                            const copySuccess = document.getElementById('copy-success');
                            copySuccess.style.display = 'block';
                            
                            // 성공 메시지는 2초 후 숨김
                            setTimeout(() => {
                                copySuccess.style.display = 'none';
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('클립보드 API 사용 실패:', err);
                            fallbackCopy();
                        });
                } else {
                    fallbackCopy();
                }
            } catch (err) {
                console.error('복사 실패:', err);
                alert('클립보드 복사를 지원하지 않는 브라우저입니다. 텍스트를 직접 선택하여 복사해주세요.');
            }
        });
        
        // 대체 복사 방법 (이전 방식)
        function fallbackCopy() {
            const textArea = document.getElementById('share-text-area');
            
            try {
                textArea.focus();
                textArea.select();
                const successful = document.execCommand('copy');
                
                if (successful) {
                    const copySuccess = document.getElementById('copy-success');
                    copySuccess.style.display = 'block';
                    
                    setTimeout(() => {
                        copySuccess.style.display = 'none';
                    }, 2000);
                } else {
                    throw new Error('복사 실패');
                }
            } catch (err) {
                console.error('복사 실패:', err);
                alert('클립보드 복사를 지원하지 않는 브라우저입니다. 텍스트를 직접 선택하여 복사해주세요.');
            }
        }
        
        // Zep 대화창에 공유하기 버튼
        document.getElementById('share-with-zep').addEventListener('click', function() {
            // 텍스트 컨테이너 표시
            const textContainer = document.querySelector('.share-text-container');
            const textArea = document.getElementById('share-text-area');
            textContainer.style.display = 'block';
            textArea.value = shareText;
            
            // 앱으로 공유 메시지 전송
            sendMessageToApp({
                type: "SHARE_TO_ZEP_CHAT",
                content: shareText
            });
            
            const copySuccess = document.getElementById('copy-success');
            copySuccess.textContent = "✓ Zep 채팅에 공유되었습니다";
            copySuccess.style.display = 'block';
            
            setTimeout(() => {
                copySuccess.style.display = 'none';
                copySuccess.textContent = "✓ 클립보드에 복사되었습니다";
            }, 2000);
        });
        
        // 앱으로 메시지를 보내는 함수
        function sendMessageToApp(data) {
            window.parent.postMessage(data, "*");
        }
    </script>
</body>
</html> 